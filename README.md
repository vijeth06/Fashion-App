# Virtual Fashion Try-On (VF-TryOn)

A **production-ready full-stack virtual try-on + Indian fashion e-commerce platform** with real products, real checkout logic, and modern AI features.

---

## ğŸ¯ Overview

**Frontend:** React 18 + React Router + Tailwind CSS + Framer Motion  
**Backend:** Node.js/Express + MongoDB + Mongoose  
**Optional Python Service:** Flask scaffold for heavy computer vision models  
**Auth:** Firebase authentication  
**Try-On:** Real-time webcam/photo overlay with pose detection  
**E-commerce:** Full cart, wishlist, orders, payments (Razorpay-ready), GST calculation, coupons  

---

## âœ¨ Key Features

### 1. Virtual Try-On
- Upload photo or use webcam in real-time
- Pose detection (TensorFlow.js + MediaPipe)
- Canvas overlay with export
- Multiple try-on pages (basic, enhanced, neural, AR-powered)
- Fabric physics simulation (quantum try-on)

### 2. E-Commerce (Indian Market Focus)
- **Products:** 15 real Indian fashion items (kurtas, sarees, sherwanis, jeans, etc.)
- **Catalog:** Search, filters by category/brand/price, similar products
- **Cart & Wishlist:** Add/remove items, persistent storage
- **Orders & Checkout:** Multi-step checkout with shipping address validation
- **Payments:** Payment integration structure (Razorpay-ready)
- **Pricing:** INR-based with GST calculation by state
- **Coupons & Discounts:** Server-side coupon validation
- **Inventory:** Real-time stock management

### 3. User Management
- Firebase authentication (signup/login)
- User profiles with biometric data & style DNA
- Multiple shipping addresses with Indian pin/state validation
- Measurement history
- Order history & tracking
- Wishlist & lookbooks (saved outfits)

### 4. Advanced Features
- **AI/ML:** Outfit recommendations, emotion-based styling, trend analysis
- **Community:** Social platform for fashion sharing
- **Sustainability:** Carbon footprint tracking, eco-rating for products
- **Analytics:** Admin dashboard with business intelligence
- **Real-time:** Live chat, notifications, order updates
- **Web3:** Basic blockchain/NFT structure (optional)

---

## ğŸ“ Project Structure

```
root/
â”œâ”€â”€ src/                          React Frontend
â”‚   â”œâ”€â”€ components/               Reusable UI components
â”‚   â”œâ”€â”€ pages/                    Route pages (Home, Catalog, Try-On, Community, etc.)
â”‚   â”œâ”€â”€ context/                  AuthContext, OutfitContext
â”‚   â”œâ”€â”€ services/                 API, product, user, community services
â”‚   â”œâ”€â”€ utils/                    Helpers, validators, recommendations
â”‚   â”œâ”€â”€ ai/                       AI/ML logic (body analysis, outfit engine, etc.)
â”‚   â”œâ”€â”€ hooks/                    Custom React hooks
â”‚   â”œâ”€â”€ styles/                   Global CSS
â”‚   â”œâ”€â”€ App.js                    Route definitions (lazy-loaded for performance)
â”‚   â””â”€â”€ index.js                  Entry point
â”‚
â”œâ”€â”€ backend/                      Node/Express API
â”‚   â”œâ”€â”€ server.js                 Express app & MongoDB connection
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.js           MongoDB connection & models
â”‚   â”œâ”€â”€ models/                   Mongoose schemas (User, Product, Order)
â”‚   â”œâ”€â”€ routes/                   API endpoints
â”‚   â”‚   â”œâ”€â”€ products.js
â”‚   â”‚   â”œâ”€â”€ users.js
â”‚   â”‚   â”œâ”€â”€ orders.js
â”‚   â”‚   â”œâ”€â”€ cart.js
â”‚   â”‚   â”œâ”€â”€ wishlist.js
â”‚   â”‚   â”œâ”€â”€ payments.js
â”‚   â”‚   â”œâ”€â”€ coupons.js
â”‚   â”‚   â”œâ”€â”€ tax.js
â”‚   â”‚   â”œâ”€â”€ reservations.js
â”‚   â”‚   â””â”€â”€ ...more
â”‚   â”œâ”€â”€ middleware/               Security, auth, validation, logging
â”‚   â”œâ”€â”€ services/                 Business logic (Database, Email, Payment, etc.)
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ seedDatabase.js       Populate DB with 15 real Indian products
â”‚   â””â”€â”€ .env                      MongoDB URI, port, secrets
â”‚
â”œâ”€â”€ backend/vastra/               Optional Python Flask service
â”‚   â”œâ”€â”€ app.py                    Flask app (scaffolded, not required)
â”‚   â””â”€â”€ requirements.txt          Python dependencies (keep this file!)
â”‚
â”œâ”€â”€ public/                       Static assets
â”œâ”€â”€ build/                        Production build (generated by `npm run build`)
â””â”€â”€ package.json, tailwind.config.js, tsconfig.json, etc.
```

---

## ğŸš€ Quick Start (5 Minutes)

### Prerequisites
- **Node.js 16+** (with npm 8+)
- **MongoDB** (local or [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) free tier)
- **Firebase project** (for frontend authentication)
- Optional: **Python 3.10+** (for `backend/vastra`)

### Step 1: Setup Backend

```bash
cd backend
npm install
```

Create `backend/.env`:
```env
MONGODB_URI=mongodb+srv://user:password@cluster.mongodb.net/vf_tryon?retryWrites=true&w=majority
PORT=5000
NODE_ENV=development
```

### Step 2: Seed Database (15 Indian Fashion Products)

```bash
cd backend
node scripts/seedDatabase.js
```

Expected output:
```
âœ… Inserted 15 products
ğŸ“Š mens-kurtas, womens-sarees, ethnic-sherwanis, ...
âœ… Database seeding completed successfully!
```

### Step 3: Start Backend Server

```bash
npm start
```

Server runs on: `http://localhost:5000`

Test with: `http://localhost:5000/health`

### Step 4: Setup Frontend

In the **root directory**, create `.env`:

```env
REACT_APP_API_URL=http://localhost:5000
REACT_APP_FIREBASE_API_KEY=your_firebase_key
REACT_APP_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your_project_id
REACT_APP_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
REACT_APP_FIREBASE_APP_ID=your_app_id
```

### Step 5: Install & Run Frontend

```bash
npm install
npm start
```

App runs on: `http://localhost:3000`

---

## ğŸ”‘ Key API Endpoints

### Products
- `GET /api/v1/products-enhanced` â€” All products (filters, pagination)
- `GET /api/v1/products-enhanced/:id` â€” Single product
- `GET /api/v1/products-enhanced/featured` â€” Featured products
- `GET /api/v1/products-enhanced/search?q=kurta` â€” Search

### Users & Cart
- `GET /api/v1/users/:uid` â€” User profile
- `POST /api/v1/users` â€” Create profile
- `GET /api/v1/users/:uid/cart` â€” Get cart
- `POST /api/v1/users/:uid/cart` â€” Add to cart
- `DELETE /api/v1/users/:uid/cart/:productId` â€” Remove from cart

### Wishlist
- `GET /api/v1/users/:uid/wishlist` â€” Get wishlist
- `POST /api/v1/users/:uid/wishlist` â€” Add to wishlist
- `DELETE /api/v1/users/:uid/wishlist/:productId` â€” Remove

### Orders & Checkout
- `POST /api/v1/orders` â€” Create order
- `GET /api/v1/orders/:orderId` â€” Order details
- `GET /api/v1/orders/:uid` â€” User orders

### Commerce Features
- `POST /api/v1/coupons/validate` â€” Check coupon code
- `POST /api/v1/tax/calculate` â€” Calculate GST (by state)
- `POST /api/v1/payments/create-intent` â€” Razorpay payment

---

## ğŸ› ï¸ Core Features Implementation

### 1. Virtual Try-On
**Files:** `src/pages/VirtualTryOn.jsx`, `src/components/AdvancedARTryOn.jsx`, `src/ai/`

- Real-time pose detection (MediaPipe Pose)
- Body segmentation & cloth overlay
- Export as image/video
- Multiple filters & effects

### 2. E-Commerce Logic
**Backend:** `backend/models/Product.js`, `backend/routes/`, `backend/services/`  
**Frontend:** `src/services/productService.js`, `src/services/userService.js`

- Product filtering (category, price range, ratings)
- Cart sync with backend
- Wishlist persistence
- Address validation (Indian pincode/state mapping)
- GST calculation (SGST/CGST by state, IGST for interstate)
- Coupon validation & discount calculation
- Order status tracking

### 3. Firebase Authentication
**File:** `src/context/AuthContext.js`

- Signup/Login with email & password
- Social login (Google, Apple)
- Token refresh & session management
- Profile sync to MongoDB on first login

### 4. Community & Social
**File:** `src/pages/CommunityFeed.jsx`

- Browse user profiles & looks
- Follow/unfollow users
- Like & comment on looks
- Search users by style/region
- Trending profiles

### 5. Admin Dashboard
**File:** `src/components/AdvancedAdminDashboard.jsx`

- Order analytics (total revenue, top products)
- User insights (new users, retention)
- Inventory management
- Payment reconciliation

---

## ğŸ“Š Database Schema

### Products Collection
```javascript
{
  productId: String,              // Unique ID
  name: String,                   // English name
  localizedName: String,          // Hindi/local name
  brand: String,
  category: String,               // kurta, saree, jeans, etc.
  type: String,
  
  price: {
    mrp: Number,                  // MRP
    selling: Number,              // Sale price
    currency: 'INR',
    discount: Number              // % off
  },
  
  sizes: [{
    size: String,                 // XS, S, M, L, XL, XXL
    stock: Number,
    measurements: { chest, waist, length, shoulder }
  }],
  
  colors: [{ name, hex, images, stock }],
  images: { main, gallery, overlay, thumbnail },
  
  material: String,               // Cotton, Silk, etc.
  occasion: [String],             // Casual, Formal, Festive
  region: String,                 // North Indian, South Indian, Western
  gstRate: Number,                // 5% or 12% (typical)
  
  aiMetadata: {
    styleVector: [Number],
    colorPalette: [String],
    trendScore: Number
  },
  
  timestamps
}
```

### Users Collection
```javascript
{
  uid: String,                    // Firebase UID
  email: String,
  
  profile: {
    name: String,
    phone: String,
    avatar: String,
    bio: String,
    region: String                // North Indian, South Indian, etc.
  },
  
  measurements: {
    height: Number,
    weight: Number,
    chest: Number,
    waist: Number,
    hip: Number
  },
  
  styleDNA: {
    preferences: [String],        // Colors, patterns, occasions
    bodyType: String
  },
  
  addresses: [{
    label: String,                // Home, Office, etc.
    name: String,
    phone: String,
    address1: String,
    city: String,
    state: String,
    pincode: String,
    isDefault: Boolean
  }],
  
  timestamps
}
```

### Orders Collection
```javascript
{
  orderId: String,                // Unique order number
  userId: String,
  
  items: [{
    productId: String,
    name: String,
    price: Number,
    quantity: Number,
    size: String,
    color: String
  }],
  
  pricing: {
    subtotal: Number,
    shipping: Number,
    discount: Number,             // Coupon/promo discount
    tax: Number,                  // GST
    total: Number,
    verifiedTotal: Number,        // Backend-computed total (strict)
    verificationTimestamp: Date
  },
  
  shippingAddress: { ... },
  
  payment: {
    method: String,               // razorpay, card, etc.
    status: String,               // pending, completed, failed
    intentId: String,
    transactionId: String
  },
  
  status: String,                 // pending, confirmed, shipped, delivered, cancelled
  
  timestamps
}
```

---

## ğŸ” Security & Best Practices

### Implemented
- **CORS & Headers:** Middleware in `backend/middleware/security.js`
- **Rate Limiting:** Prevent brute force / DDoS
- **JWT Verification:** Firebase tokens validated on backend
- **Input Validation:** All user inputs sanitized (Joi)
- **Audit Logging:** Track sensitive operations
- **GDPR Endpoints:** User data export & deletion routes

### Recommended for Production
- Enable HTTPS/SSL
- Use environment secrets (AWS Secrets Manager, HashiCorp Vault)
- Rotate Firebase service account keys regularly
- Enable MongoDB IP whitelisting
- Set up monitoring & alerting (Sentry, DataDog)
- Implement request signing for payment callbacks

---

## ğŸ“ˆ Performance Optimizations

### Frontend
- **Lazy-Loading Routes:** `React.lazy()` + `<Suspense>` for heavy pages
- **Code Splitting:** Automatic per-route chunks
- **Image Optimization:** Compressed formats, responsive sizes
- **Caching:** Service Worker for offline support

### Backend
- **Database Indexing:** Indexes on `productId`, `uid`, `email` (see `backend/config/database.js`)
- **Pagination:** Products API returns 20 items/page
- **API Response Caching:** Redis-ready (scaffold in place)

---

## ğŸ§ª Testing

Run tests:
```bash
npm test                          # Frontend tests
cd backend && npm test            # Backend tests (if configured)
```

---

## ğŸ“¦ Deployment

### Vercel (Frontend)
```bash
npm run build
vercel deploy --prod
```

### Heroku/Railway (Backend)
```bash
cd backend
git push heroku main
```

Ensure `MONGODB_URI` and other secrets are set in deployment env vars.

---

## ğŸ› Troubleshooting

### Backend won't start
```bash
# Check MongoDB connection
echo $MONGODB_URI

# Check if port 5000 is in use
lsof -i :5000          # macOS/Linux
netstat -ano | findstr :5000  # Windows
```

### Frontend can't reach backend
```bash
# Verify REACT_APP_API_URL in .env
cat .env | grep REACT_APP_API_URL

# Test from browser console
fetch('http://localhost:5000/health')
  .then(r => r.json())
  .then(console.log)
```

### Products not showing
```bash
# Verify database seeded
cd backend
npm list | grep mongoose

# Check MongoDB collections
# Open MongoDB Atlas â†’ Collections â†’ vf_tryon_db
```

---

## ğŸ“ Recent Improvements

### Performance (Latest)
- Implemented route-level code splitting with `React.lazy()` and `<Suspense>`
- Removed eager imports of heavy pages (QuantumTryOn, Metaverse, etc.) from main bundle
- Extracted framer-motion-heavy QuantumTryOnPage into lazy-loaded module
- Fixed Checkout page cart state initialization

### E-Commerce Logic
- Confirmed all routes wired: coupons, tax, reservations
- Tightened payment validation with server-side total recomputation (Â±â‚¹0.001 tolerance)
- GST calculation by state (SGST/CGST for intra-state, IGST for inter-state)
- Cart sync & wishlist sync with idempotent operations
- Address validation for Indian pins/states

### UI/UX
- Fixed Community search input text visibility (white text on white background â†’ gray-900)
- Styled search placeholder with proper contrast

---

## ğŸ¤ Contributing

1. Create a feature branch: `git checkout -b feature/your-feature`
2. Commit changes: `git commit -am 'Add new feature'`
3. Push to branch: `git push origin feature/your-feature`
4. Open a pull request

---

## ğŸ“„ License

This project is **private**. Do not share without permission.

---

## ğŸ“ Support & Contact

For questions or issues:
1. Check [Troubleshooting](#troubleshooting) above
2. Review backend logs: `backend/logs/` (if configured)
3. Check MongoDB Atlas logs for database errors

---

**Last Updated:** December 2025  
**Version:** 1.0.0  
**Status:** Production-Ready âœ…
